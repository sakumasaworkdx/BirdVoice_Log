<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>野鳥音声解析ツール - FieldLog Audio Professional</title>
  <style>
    :root {
      --bg: #0b1220; --card: #161f32; --accent: #3b82f6; --text: #e8eefc;
      --muted: #a9b6d6; --radius: 12px;
    }
    body {
      margin: 0; font-family: sans-serif; background: var(--bg); color: var(--text);
      display: flex; flex-direction: column; height: 100vh; overflow: hidden;
    }
    header { padding: 1rem 2rem; background: rgba(255,255,255,0.05); display: flex; align-items: center; gap: 1rem; }
    .main-layout { display: flex; flex: 1; overflow: hidden; }
    .sidebar { width: 380px; padding: 1.5rem; overflow-y: auto; border-right: 1px solid rgba(255,255,255,0.1); background: var(--card); }
    .content { flex: 1; display: flex; flex-direction: column; position: relative; background: #000; }
    
    .card { background: rgba(255,255,255,0.03); border-radius: var(--radius); padding: 1rem; margin-bottom: 1rem; border: 1px solid rgba(255,255,255,0.05); }
    .subhead { font-size: 0.85rem; font-weight: bold; color: var(--accent); margin-bottom: 0.8rem; text-transform: uppercase; }
    
    .input-group { margin-bottom: 1rem; }
    label { display: block; font-size: 0.8rem; margin-bottom: 0.4rem; color: var(--muted); }
    .flex-row { display: flex; align-items: center; gap: 8px; }
    input[type="number"] { width: 70px; background: #000; border: 1px solid #444; color: #fff; padding: 4px; border-radius: 4px; }
    input[type="range"] { flex: 1; }
    
    button { 
      padding: 8px 16px; border-radius: 6px; border: none; cursor: pointer; font-weight: bold; transition: 0.2s;
    }
    button.primary { background: var(--accent); color: white; width: 100%; margin-top: 10px; }
    button.primary:disabled { background: #444; cursor: not-allowed; }
    button.ghost { background: rgba(255,255,255,0.1); color: white; font-size: 0.75rem; }
    button.ghost:hover { background: rgba(255,255,255,0.2); }

    .detect-list { display: grid; grid-template-columns: repeat(3, 1fr); gap: 6px; max-height: 200px; overflow-y: auto; padding: 5px; }
    .detect-btn { background: #1e293b; color: #cbd5e1; border: 1px solid #334155; padding: 4px; font-size: 0.7rem; border-radius: 4px; }
    
    .viewport { flex: 1; overflow: auto; position: relative; cursor: crosshair; }
    .canvas-container { position: relative; }
    #specCanvas { display: block; background: #000; }
    #playbackLine { position: absolute; top: 0; left: 0; width: 2px; height: 100%; background: red; pointer-events: none; z-index: 10; }
    
    .progress-wrap { margin-top: 10px; }
    .bar { height: 6px; background: #222; border-radius: 3px; overflow: hidden; }
    #scanBar { height: 100%; width: 0%; background: var(--accent); transition: width 0.1s; }
  </style>
</head>
<body>

<header>
  <div style="font-weight:bold; font-size:1.2rem;">BirdVoice Log <span style="font-weight:normal; font-size:0.8rem; opacity:0.6;">v3 Professional</span></div>
  <input type="file" id="fileInput" accept="audio/*" />
  <div id="status" style="font-size:0.8rem; color:var(--accent);">ファイルを待機中...</div>
</header>

<div class="main-layout">
  <div class="sidebar">
    
    <div class="card">
      <div class="subhead">解析プリセット</div>
      <div class="flex-row" style="flex-wrap: wrap;">
        <button class="ghost" onclick="setPreset(800, 4000, -50)">夜間汎用</button>
        <button class="ghost" onclick="setPreset(400, 1200, -42)">フクロウ</button>
        <button class="ghost" onclick="setPreset(2000, 2800, -35)">トラツグミ</button>
      </div>
    </div>

    <div class="card">
      <div class="subhead">スキャン設定</div>
      <div class="input-group">
        <label>最小周波数 (Hz)</label>
        <div class="flex-row">
          <input type="range" id="scanMinHz" min="0" max="12000" step="100" value="1000" />
          <input type="number" id="scanMinHzNum" value="1000" />
        </div>
      </div>
      <div class="input-group">
        <label>最大周波数 (Hz)</label>
        <div class="flex-row">
          <input type="range" id="scanMaxHz" min="0" max="12000" step="100" value="5000" />
          <input type="number" id="scanMaxHzNum" value="5000" />
        </div>
      </div>
      <div class="input-group">
        <label>検出感度 (dB)</label>
        <div class="flex-row">
          <input type="range" id="scanThreshold" min="-100" max="0" step="1" value="-50" />
          <input type="number" id="scanThresholdNum" value="-50" />
        </div>
      </div>
      
      <button id="scanBtn" class="primary">解析実行（全時間）</button>
      
      <div class="progress-wrap">
        <div style="font-size:0.7rem; margin-bottom:4px; display:flex; justify-content:space-between;">
          <span>進捗</span> <span id="scanPct">0%</span>
        </div>
        <div class="bar"><div id="scanBar"></div></div>
      </div>
    </div>

    <div class="card">
      <div class="subhead">検出箇所リスト</div>
      <div id="detectList" class="detect-list"></div>
    </div>
  </div>

  <div class="content">
    <div id="viewport" class="viewport">
      <div class="canvas-container" id="canvasContainer">
        <canvas id="specCanvas"></canvas>
        <div id="playbackLine"></div>
      </div>
    </div>
  </div>
</div>

<script src="script.js"></script>
</body>
</html>
